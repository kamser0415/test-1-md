# tdd-test-section-00-OT

**시나리오**  
회귀 버그(`Regression`)로 프로젝트의 버전이나, 신규 기능을 배포할 경우 없던 버그가 발생하다보니 
프로젝트는 개발 속도도 느려지고, 버전도 업데이트가 어려워집니다.  
  
회귀 버그를 잡기 위해서 테스트 코드를 작성해야하고, 테스트 코드의 결과는 내부만 알 수 있기 때문에
커버리지를 통해서 집계를 통해 위에 보고 해야하는 상황입니다.  
  
테스트 코드도 마찬가지로 테스트를 작성하다보니, 커버리지를 맞추기 위해서 커버리지를 위한 테스트 코드가 작성되고 
외부 네트워크나 DB가 포함된 테스트 코드는 시간이 오래걸리다보니 오히려 짐이 됩니다.  
  
## 테스트 코드가 실패하는 이유

1. **레커시 코드에 테스트를 넣는게, TDD는 아닙니다.**  
  
2. **레거시에 테스트를 넣으려면 코드개선이 필요합니다.**
    테스트의 목적
    1. 회귀 버그 방지
    2. 유연한 설계로 개선으로 테스트를 쉽게 만들고, 테스트를 결정적이게 만들어줍니다.  
3. **커버리지에 집착하면 안됩니다.**
  
결과  
: 커버리지를 올리기위한 mock 프레임 워크 사용법만 고민하고, 
왜 테스트를 하는지,어떻게 테스트를 해야 하는지 고민하지 않았기 때문입니다.  

간단한 테스트를 하는 과정인데 테스트를 하기 위해서 준비해야하는 과정이 길어집니다

```Java
@SpringbootTest
public class ServiceTest {
    
    @Autowired
    private ServiceA serviceA;
    
    @Autowired
    private RepositoryA repositoryA;
    
    @Autowired
    private RepositoryB repositoryB;
    
    @Autowired
    private RepositoryC repositoryC;
    
    @Test
    public void functionATest(){
        //given
        //entity set
        A a = new A();
        B b = new B();
        C c = new C();
        
        repositoryA.save(a);
        repositoryB.save(b);
        repositoryC.save(c);
        
        //when
        serviceA.functionA();
        
        //then
        assertThat(...);
    }
}
```

## 정리  
개발한 기능이나 비즈니스 로직을 테스트 하기 위해서 작성한 테스트 코드도 물론 중요합니다.  
하지만, 애플리케이션을 이용하는 사람이 늘고 신규 기능을 개발하거나 확장할 때 새로 만든다면 
테스트 코드는 반복해서 작성할 수 있지만, 확장하는 시간을 줄일 수 없습니다.  
  
테스트 코드를 작성시 설계를 변경하지 않고 딱딱한 코드에 테스트 코드만 얹는건 의미가 없습니다.  
확장하게 되면 새로 작성해야하는 짐밖에 되지 않기 때문에 
테스트 코드는 설계와 함께 변경해야하는 겁니다.  
  
그래서 테스트하기 좋은 코드로 설계를 변경 후에 테스트를 작성해야합니다.
  

TDD를 이야기하기 전에 본인의 코드에 테스트를 넣는 방법을 알아야합니다.  
TDD와 테스트의 개념을 섞어서 섰다가 이도 저도 아니게 될수 있습니다.  
  
**_테스트 코드는 회귀 버그 방지도 있지만, 유연한 설계할 수 있다는 가치가 정말로 중요합니다._**
  
테스트 코드를 작성해도 의존적인 방식으로 코드를 작성하면 테스트 코드 작성도 어려워지게 되고
설계를 건들지 않고 테스트 코드만 작성하는 것은 둘다 놓치게 됩니다.  
  
커버리지는 테스트 코드가 얼마나 촘촘하게 작성되었는지 평가할 수 있는 중요한 지표이지만, 
코드를 작성하다보면 생각보다 테스트가 필요없는 부분이 있을 수 있습니다.  
  
테스트를 추가 했을 때 얻을 수 있는 **_효용성_**을 생각해야지, 
커버리지 자체가 목적이 되버리면 테스트를 통해 얻을 수 있는 장점을 놓치게 됩니다.  
  
Mock을 어떻게 잘쓸지, Junit을 어떻게 잘쓸지 고민만 하는건 위험합니다.  
  
**_결국, 테스트를 왜 해야하고 테스트를 통해 얻을 수 있는 핵심 가치가 무엇인지 고민해야합니다._**  
  
회귀 버그만 신경쓴 테스트 코드는 자동차의 부품이 정상 동작하는지 검사하는 것과 동일합니다. 
추후 확장하게 되어 새 프로젝트가 된다면 재활용은 할 수 있지만 추가 코드를 작성해야하는건 동일합니다.